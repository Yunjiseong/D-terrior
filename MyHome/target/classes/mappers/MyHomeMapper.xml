<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper	namespace="com.spring.myWeb.myhome.mapper.IMyHomeMapper">

	<resultMap type="com.spring.myWeb.command.MyHomeVO" id="HomeMap">
		<result column="regdate" property="regDate" />
		<result column="updatedate" property="updateDate"/>
		<result column="like_cnt" property="likeCnt"/>
		<result column="view_cnt" property="viewCnt"/>
		<result column="scrap_cnt" property="scrapCnt"/>
		<result column="homeform" property="homeForm"/>
		<result column="homesize" property="homeSize"/>
		<result column="thumb_img" property="thumbImg"/>
	</resultMap>
	
	<sql id="order">		
		<choose>
			<when test="sort == 2">ORDER BY likeCnt DESC</when>
			<otherwise>ORDER BY regdate DESC</otherwise>
		</choose>
		
	</sql>	
	
	<sql id="search">
		<if test="homeForm != ''">homeform = #{homeForm, jdbcType=VARCHAR} </if>
		<if test="homeForm == ''">bno IS NOT NULL </if>
		<if test="money != ''"> AND money = #{money, jdbcType=VARCHAR}</if>
		<if test="homeSize != ''"> AND homesize = #{homeSize, jdbcType=VARCHAR}</if>
	</sql>
	
	<insert id="regist">
		INSERT INTO myhome(bno, writer, title, content, thumb_img, homeform, money, homesize, place, direction, room, age, family, worker, region, img1, img2, img3, img4, img5, img6, img7, img8, img9, img10)
		VALUES(myhome_seq.NEXTVAL, #{writer}, #{title}, #{content}, #{thumbImg, jdbcType=VARCHAR}, #{homeForm, jdbcType=VARCHAR}, #{money, jdbcType=VARCHAR}, #{homeSize, jdbcType=VARCHAR}, #{place, jdbcType=VARCHAR}, #{direction, jdbcType=VARCHAR}, #{room, jdbcType=VARCHAR}, #{age, jdbcType=VARCHAR}, #{family, jdbcType=VARCHAR}, #{worker, jdbcType=VARCHAR}, #{region, jdbcType=VARCHAR}, #{img1, jdbcType=VARCHAR}, #{img2, jdbcType=VARCHAR}, #{img3, jdbcType=VARCHAR}, #{img4, jdbcType=VARCHAR}, #{img5, jdbcType=VARCHAR}, #{img6, jdbcType=VARCHAR}, #{img7, jdbcType=VARCHAR}, #{img8, jdbcType=VARCHAR}, #{img9, jdbcType=VARCHAR}, #{img10, jdbcType=VARCHAR})
	</insert>
	
	<select id="getList" resultMap="HomeMap">
		SELECT * FROM
			(
			SELECT ROWNUM rn, tbl.* FROM
				(
				SELECT * FROM myhome
				WHERE <include refid="search" />
				<include refid="order" />
				) tbl
			)
		<![CDATA[
		WHERE rn > (#{nowPage}-1) * #{countPerPage} 
		AND rn <= #{nowPage} * #{countPerPage}
		]]> 
	</select>
	
	<select id="getDetail" resultMap="HomeMap">
		SELECT * FROM myhome
		WHERE bno=#{bno}
	</select>
	
	<select id="getTotalArticles" resultType="int">
		SELECT COUNT(*) FROM myhome
		WHERE <include refid="search" />
	</select>
	
	<update id="update">
		UPDATE myhome SET title=#{title}, content=#{content}, thumb_img=#{thumbImg, jdbcType=VARCHAR}, updatedate=sysdate, homeform = #{homeForm, jdbcType=VARCHAR}, money=#{money, jdbcType=VARCHAR}, homesize=#{homeSize, jdbcType=VARCHAR}, place=#{place, jdbcType=VARCHAR}
		, direction=#{direction, jdbcType=VARCHAR}, room=#{room, jdbcType=VARCHAR}, age=#{age, jdbcType=VARCHAR}, family=#{family, jdbcType=VARCHAR}, worker=#{worker, jdbcType=VARCHAR}, region=#{region, jdbcType=VARCHAR}, img1=#{img1, jdbcType=VARCHAR}, img2=#{img2, jdbcType=VARCHAR}, img3=#{img3, jdbcType=VARCHAR}, img4=#{img4, jdbcType=VARCHAR}, img5=#{img5, jdbcType=VARCHAR}, img6=#{img6, jdbcType=VARCHAR}, img7=#{img7, jdbcType=VARCHAR}, img8=#{img8, jdbcType=VARCHAR}, img9=#{img9, jdbcType=VARCHAR}, img10=#{img10, jdbcType=VARCHAR}
		WHERE bno=#{bno}
	</update>
	
	<delete id="delete">
		DELETE FROM myhome WHERE bno=#{bno}
	</delete>


	
</mapper>